---
tags:
---

# DB와 디스크 읽기 방식
- (Real MySQL 8장 인덱스 내용 중)
- 컴퓨터의 전기적 특성을 띤 장치들(cpu, 메모리) 등과는 달리 디스크 같은 기계식 장치의 성능은 상당히 제한적으로 발전했다.
	- SSD가 등장한 최근에도, 여전히 데이터 저장 매체는 컴퓨터에서 가장 느린 부분에 해당한다.
	- 데이터베이스 성능 튜닝은 어떻게 디스크 I/O를 줄이느냐가 관건이 때가 상당히 많다. 
## 8.1.1 하드 디스크 드라이브(HDD)와 솔리드 스테이트 드라이브(SSD)
- HDD 
	- 기계식 장치
	- DB 서버에서는 항상 디스크 장치가 병목이 된다. 
- SSD(Solid State Drive)
	- HDD를 대체하기 위한 전자식 저장매체
	- 기존 하드 디스크 드라이브와 같은 인터페이스(SATA, SAS)를 지원하므로 내장 디스크나 DAS 또는 SAN에 그대로 사용할 수 있다. 
	- 기존 하드 디스크 드라이브에서 데이터 저장용 플래터(원판)을 제거하고 그 대신 플래시 메모리를 장착 -> 데이터 엑세스를 위해 원판을 회전시킬 필요가 없으므로 아주 빨리 데이터를 읽고 쓸 수 있다. 
	- 기타 특징 : 플래시 메모리는 전원이 공급되지 않아도 데이터가 삭제되지 않는다. 컴퓨터 메모리 D-RAM보다는 느리지만 기계식 하드 디스크 드라이브보다는 훨씬 빠르다.
- HDD와 SDD의 성능 차이
	- 컴퓨터 주요 부품별 처리 속도의 차이
		- ![[주요 장치의 초당 처리 횟수.png]]
	- 처리 속도에서 SSD가 기존 HDD보다 1000 배 정도의 속도 차이를 보이기 때문에, 현재의 DBMS용 서버에는 대부분 SSD를 채택하고 있다.
	- 디스크의 헤더를 움직이지 않고 한 번에 많은 데이터를 읽는 순차 I/O에서는 SSD가 HDD보다 조금 빠르거나 거의 비슷한 성능을 보이기도 한다. 
		- 하지만 랜덤 I/O는 SSD가 훨씬 빠른 속도를 보여준다.
		- DB서버에서 순차 I/O작업은 그다지 비중이 크지 않고, 랜덤 I/O를 통해 작은 데이터를 읽고 쓰는 작업이 대부분이다.
		- ![[솔리드 스테이드 드라이브와 하드 디스크 드라이브의 성능 벤치 마크.png]]

## 8.1.2 랜덤 I/O와 순차 I/O
- 랜덤 I/O
	- 데이터를 임의의 위치에서 읽거나 쓰는 방식으로 디스크 헤드를 여러 번 이동시켜야 하므로 순차 I/O에 비해 더 많은 시간이 소요
- 순차 I/O
	- 데이터를 순서대로 읽거나 쓰는 방식으로 디스크의 처음부터 끝까지 순차적으로 접근.
- 랜덤 I/O 작업과 순차 I/O 작업의 예시
	- Real MySQL 1권 216p
	- 순차 I/O는 3개의 페이지를 디스크에 기록하기 위해 1번의 시스템 콜 요청, 즉 디스크에 기록할 위치를 찾기 위해 디스크 헤드 1번 움직임. 
	- 랜덤 I/O는 3개의 페이지를 디스크에 기록하기 위해 3번의 시스템 콜 요청, 즉 디스크에 기록할 위치를 찾기 위해 디스크 헤드 3번 움직임. 
	- 랜덤 I/O 작업이 순차 I/O 작업보다 부하가 훨씬 더 크다.
- 디스크 원판을 가지지 않는 SSD에서도 랜덤 I/O가 순차 I/O보다 전체 스루풋(Throughput)이 떨어진다. 
>[!note] 랜덤 I/O나 순차 I/O 모두 파일에 쓰기를 실행하면 반드시 동기화(fsync 또는 flush 작업)가 필요하다. 그런데 순차 I/O인 경우에도 이러한 파일 동기화 작업이 빈번하게 발생한다면 랜덤 I/O처럼 비효율적인 형태로 처리될 때가 많다. 기업용 DB서버에서는 캐시 메모리가 장착된 RAID 컨트롤러가 일반적으로 사용되는데, RAID 컨트롤러의 캐시 메모리는 아주 빈번한 파일 동기화 작업이 호출되는 순차 I/O를 효율적으로 처리될 수 있게 변환하는 역할을 한다. 하드 디스크 드라이브 뿐만 아니라 SSD를 사용하는 경우에도 여전히 RAID 컨트롤러는 중요한 역할을 하기 때문에 RAID 컨트롤러와 RAID 컨트롤러에 장착된 캐시의 성능을 무시하지 말자.

- 사실 쿼리를 튜닝해서 랜덤 I/O를 순차 I/O로 바꿔서 실행할 방법은 그다지 많지 않다. 
	- **일반적으로 쿼리를 튜닝하는 것은 랜덤 I/O 자체를 줄이는 것이 목적이다.**
	- = 쿼리를 처리할 때 꼭 필요한 데이터만 읽도록 쿼리를 개선하는 것을 의미.
> [! note] **[[인덱스 레인지 스캔]]은 데이터를 읽기 위해 주로 랜덤 I/O를 사용**하며, **풀 테이블 스캔은 순차 I/O를 사용**한다. 그래서 큰 테이블의 레코드 대부분을 읽는 작업에서는 인덱스를 사용하지 않고 풀 테이블 스캔을 사용하도록 유도할 때도 있다. 이는 순차 I/O가 랜덤 I/O보다 훨씬 빨리 많은 레코드를 읽어올 수 있기 때문인데, 이런 형태는 **OLTP(On-Line Transaction Processing) 성격의 웹 서비스 보다**는 **데이터 웨어 하우스나 통계 작업에서 자주 사용**한다.

