- 스토리지 엔진에서 파셜 페이지 현상이 발생할 때를 대비해, 플러시 전에 미리 해당 값들을 버퍼에 저장하는 과정을 거치는데, 이 대비 버퍼를 Double Write Buffer라고 한다. 
	- 즉, 플러시 전에 임시로 플러시 할 값(더티 페이지) 들을 묶어 버퍼에 기록해두는 것.
- 파셜 페이지(Partial Page)란?
	-  더티 페이지를 디스크로 플러시할 때, 하드웨어의 오작동, 시스템의 비 정상 종료 등으로 디스크 파일에 일부만 기록되는 현상을 파셜 페이지, 혹은 톤 페이지(Torn-Page)라고 한다. 
- InnoDB의 리두 로그는 공간 효율을 위해, 페이지의 변경 내용만 기록한다. 그로 인해 플러시 중에 문제가 생겨 파셜 페이지가 발생하면, 리두 로그만으로는 복구하기 불가능 할 수 있다.
	- 더티 페이지가 생겼다는 것은 버퍼 풀에 해당 페이지들이 적재 되어있다는 뜻이므로, Double Write Buffer를 위해 다시 디스크 접근을 할 필요는 없음.  

![[Double Write Buffer 작동 방식.png]]
- InnoDB 스토리지 엔진은 재시작할 때 항상 Double Write Buffer의 내용을 데이터 파일의 페이지로 복사한다. 
- Double Write 기능을 사용할 지 여부는 `innodb_doublewrite 시스템 변수`로 제어할 수 있다. 

 ### 디스크 종류와 Double Write 시스템
 - Double Write 시스템은 데이터 안정성을 위해 사용하는데, HDD같은 저장 시스템에서는 어차피 한 번의 순차 디스크 쓰기를 하는 것이기 때문에 별로 부담이 되지 않는다.
 - 그러나 SSD처럼 랜덤 IO나 순차 IO의 비용이 비슷한 저장 시스템에서는 상당히 부담스럽다.

 ### Double Write 시스템 사용시 주의점
 - 일반적으로 MySQL 서버에서는 복제를 이용해 동일 데이터에 대해 여러 개의 사본을 유지하기 때문에 MySQL 서버가 비정상 종료되면 버리고 백업과 바이너리 로그를 이용해 다시 동기화 할 수도 있다.
 - 데이터 무결성에 민감한 서비스라면 DoubleWrite뿐만 아니라 InnoDB의 리두 로그와 복제를 위한 바이너리 로그 등, 트랜잭션을 COMMIT하는 시점에 동기화할 것들이 많아진다.
 - Double Write는 리두 로그를 보완하기 위한 기능이기에, 리두 로그를 동기화하지 않으면서, Double Write만 활성화하는 것은 당연히 말이 안되는 상황이다.


---

[[참조 문헌]]
[MySQL - Double Write Buffer(이중 쓰기 버퍼) | Hoing](https://hoing.io/archives/1114)
